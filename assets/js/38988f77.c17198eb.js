"use strict";(self.webpackChunkhui_blog=self.webpackChunkhui_blog||[]).push([[625],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(a),m=r,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||i;return a?n.createElement(h,o(o({ref:t},c),{},{components:a})):n.createElement(h,o({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},2962:function(e,t,a){a.r(t),a.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],s={slug:"public-api-consumption",title:"You want to consume apis, but how?",tags:["api","oath2","curl","http"]},l=void 0,p={permalink:"/hui-blog/blog/public-api-consumption",source:"@site/blog/2022-04-01-public-api-comsumption.md",title:"You want to consume apis, but how?",description:"The origin of most of our ideas and solutions are the daily problems that we face. Usually the reasoning behind it is just to make life easier (thats probably what Jeff Bezos thought when he started Amazon).",date:"2022-04-01T00:00:00.000Z",formattedDate:"April 1, 2022",tags:[{label:"api",permalink:"/hui-blog/blog/tags/api"},{label:"oath2",permalink:"/hui-blog/blog/tags/oath-2"},{label:"curl",permalink:"/hui-blog/blog/tags/curl"},{label:"http",permalink:"/hui-blog/blog/tags/http"}],readingTime:2.955,truncated:!1,authors:[],frontMatter:{slug:"public-api-consumption",title:"You want to consume apis, but how?",tags:["api","oath2","curl","http"]},nextItem:{title:"How to make your certificates available inside your Java container",permalink:"/hui-blog/blog/java-container-certificates"}},c={authorsImageUrls:[]},u=[{value:"Request Access",id:"request-access",level:2},{value:"Access granted",id:"access-granted",level:2},{value:"Oauth Token",id:"oauth-token",level:2},{value:"My Sweet First Request",id:"my-sweet-first-request",level:2}],d={toc:u};function m(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The origin of most of our ideas and solutions are the daily problems that we face. Usually the reasoning behind it is just to make life easier (thats probably what Jeff Bezos thought when he started Amazon)."),(0,i.kt)("p",null,"Personally, I've been looking for a house or apartment that is to my liking, well located and doesn't dry up my walled \ud83d\udcb8\ud83d\udcb8\ud83d\udcb8. So what I normally do is open a webpage called ",(0,i.kt)("a",{parentName:"p",href:"https://www.idealista.pt/pt/"},"Idealista")," which provided a real estate listing given desired parameters, which is most of the time equivelent to less money and more space.\nChecking the page daily and always finding the same old ads is a bit frustrating and time consuming so...why not make my life easier and become the next Jeff Bezos?"),(0,i.kt)("h2",{id:"request-access"},"Request Access"),(0,i.kt)("p",null,"Usually all api providers they have a page or form where you can contact them and ask for access, in my case, Idealista makes it available through ",(0,i.kt)("a",{parentName:"p",href:"https://developers.idealista.com/access-request"},"https://developers.idealista.com/access-request"),". But the experience should be very similar with any other platform, such as Twitter or Instagram."),(0,i.kt)("p",null,"They will ask you to describe your project and usage. For different use cases they provide different types of access."),(0,i.kt)("p",null,"As my use case is purely educational and personal, I was offered a free 100 requests per month tier."),(0,i.kt)("h2",{id:"access-granted"},"Access granted"),(0,i.kt)("p",null,"One day later I had received credentials and an example on how to interact with their api."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'We have enabled the access to idealista api(documentation is in the attachments):\nApikey: <APIKEY>\nSecret: <SECRET>\nAccess is free to a maximum of 100 req/month and it\u2019s limited by 1 req/sec. If you need to perform a greater number of requests, let us know.\nExample:\ncurl -X POST -H "Authorization: Bearer {{OAUTH_BEARER}}" -H "Content-Type: multipart/form-data;" -F "center=40.430,-3.702" -F "propertyType=homes" -F "distance=15000" -F "operation=sale" "https://api.idealista.com/3.5/es/search"\n')),(0,i.kt)("h2",{id:"oauth-token"},"Oauth Token"),(0,i.kt)("p",null,"One of the parameters to access their api is an authentication bearer."),(0,i.kt)("p",null,"We can request a token using the credentials that was provided to us."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl -X POST -H \"Authorization: Basic <B64(APIKEY:SECRET)>\" -H \"Content-Type: application/x-www-form-urlencoded;\" --data 'grant_type=client_credentials' 'https://api.idealista.com/oauth/token'\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<B64(APIKEY:SECRET)>")," is basically APIKEY and SECRET separated by a colon, and the encoded using base64. Many tools allows you to encode a string into b64 and ",(0,i.kt)("a",{parentName:"p",href:"https://www.base64encode.org/"},"base64encode")," was my choice this time as it is very easy and intuitive to use."),(0,i.kt)("p",null,"If the above command yields success, we should be getting an response similar to:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"access_token":"<ACCESS_TOKEN>","token_type":"bearer","expires_in":43199,"scope":"read","jti":"c0fc3973-fbcb-4956-bb03-132a17d43faf"}\n')),(0,i.kt)("h2",{id:"my-sweet-first-request"},"My Sweet First Request"),(0,i.kt)("p",null,"Now that we're officially permissioned, let's give it a roll."),(0,i.kt)("p",null,"Using their example and the token that we have just retrieved:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'curl -X POST -H "Authorization: Bearer <ACCESS_TOKEN>" -H "Content-Type: multipart/form-data;" -F "center=40.430,-3.702" -F "propertyType=homes" -F "distance=15000" -F "operation=sale" "https://api.idealista.com/3.5/es/search"\n')),(0,i.kt)("p",null,"Which results in:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"elementList":[{"propertyCode":"97243617","thumbnail":"https://img3.idealista.com/blur/WEB_LISTING/0/id.pro.es.image.master/84/5c/ca/973391027.jpg","externalReference":"V224Q6","numPhotos":21,"floor":"1","price":1250000.0,"propertyType":"flat","operation":"sale","size":162.0,"exterior":true,"rooms":4,"bathrooms":3,"address":"barrio Castellana","province":"Madrid","municipality":"Madrid","district":"Barrio de Salamanca","country":"es","neighborhood":"Castellana","latitude":40.434576,"longitude":-3.6824301,"showAddress":false,"url":"https://www.idealista.com/inmueble/97243617/","distance":"1732","description":"\ud83d\udcdc","hasVideo":true,"status":"good","newDevelopment":false,"hasLift":true,"parkingSpace":{"hasParkingSpace":true,"isParkingSpaceIncludedInPrice":true},"priceByArea":7716.0,"detailedType":{"typology":"flat"},"suggestedTexts":{"subtitle":"Castellana, Madrid","title":"Piso"},"hasPlan":true,"has3DTour":true,"has360":false,"hasStaging":false,"topNewDevelopment":false},{"propertyCode":"95688518","thumbnail":"https://img3.idealista.com/blur/WEB_LISTING/0/id.pro.es.image.master/37/26/5d/954364457.jpg","externalReference":"ag164339","numPhotos":30,"floor":"5","price":740000.0,"propertyType":"flat","operation":"sale","size":121.0,"exterior":true,"rooms":2,"bathrooms":2,"address":"DON RAM\xd3N DE LA CRUZ","province":"Madrid","municipality":"Madrid","district":"Barrio de Salamanca","country":"es","neighborhood":"Goya","latitude":40.4264599,"longitude":-3.671863,"showAddress":false,"url":"https://www.idealista.com/inmueble/95688518/","distance":"2580","description":"\ud83d\udcdc","hasVideo":true,"status":"good","newDevelopment":false,"hasLift":true,"parkingSpace":{"hasParkingSpace":true,"isParkingSpaceIncludedInPrice":true},"priceByArea":6116.0,"detailedType":{"typology":"flat"},"suggestedTexts":{"subtitle":"Goya, Madrid","title":"Piso en DON RAM\xd3N DE LA CRUZ"},"hasPlan":true,"has3DTour":true,"has360":false,"hasStaging":true,"topNewDevelopment":false}\n...\n...\n...\n],"total":20570,"totalPages":1029,"actualPage":1,"itemsPerPage":20,"numPaginations":0,"hiddenResults":false,"summary":["Comprar","Viviendas","barrio Trafalgar, Madrid","Todos los precios","Todos los tama\xf1os"],"alertName":"Viviendas en barrio Trafalgar, Madrid","upperRangePosition":20,"paginable":true,"lowerRangePosition":0}\n')),(0,i.kt)("p",null,"Replaced description with \ud83d\udcdc and removed most of the results due to the response being massive. But as you can see, we've successfully invoked Idealist's api and got a response.\nNow it's time to create an ",(0,i.kt)("a",{parentName:"p",href:"https://quarkus.io/"},(0,i.kt)("em",{parentName:"a"},"Quarkus"))," application with it, containerize, deploy to ",(0,i.kt)("a",{parentName:"p",href:"http://redhat.com/en/technologies/cloud-computing/openshift"},(0,i.kt)("em",{parentName:"a"},"OpenShift"))," as a ",(0,i.kt)("a",{parentName:"p",href:"http://knative.dev"},(0,i.kt)("em",{parentName:"a"},"Knative"))," ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/knative/specs/blob/main/specs/serving/knative-api-specification-1.0.md#service"},(0,i.kt)("em",{parentName:"a"},"Service"))," and call it periodically using a ",(0,i.kt)("a",{parentName:"p",href:"https://knative.dev/docs/eventing/sources/ping-source/reference/"},(0,i.kt)("em",{parentName:"a"},"Ping Source"))," over a ",(0,i.kt)("a",{parentName:"p",href:"https://knative.dev/docs/eventing/channels/"},(0,i.kt)("em",{parentName:"a"},"Channel"))," and sends me a message to my Telegram."),(0,i.kt)("p",null,"Just kidding, that would be too much, right? (Stay tuned!)"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"I've deliberately switched some sensitive information like ",(0,i.kt)("inlineCode",{parentName:"p"},"ACCESS_TOKEN"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"APIKEY")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"SECRET"),", because 100 request per months is very limiting and I don't want everyone to use my resources. So hands off! \ud83d\ude45\u200d\u2642\ufe0f\ud83d\ude45\u200d\u2642\ufe0f\ud83d\ude45\u200d\u2642\ufe0f"))))}m.isMDXComponent=!0}}]);